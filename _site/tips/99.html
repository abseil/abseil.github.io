<!DOCTYPE html>
<html lang="en" itemscope itemtype="https://schema.org/WebPage">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="title" content="Abseil open-source foundational code">
    <meta name="description" content="Battle-tested, Mom-approved">
    <title>abseil / Tip of the Week #99: Nonmember Interface Etiquette</title>

    <!-- Fontawesome Icons -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    
    <!-- Favicons -->
    <link rel="shortcut icon" type="image/x-icon" href="/favicons/favicon.ico" />
    
    <!-- Bootstrap -->
    <link href="/libs/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Site style using SASS, generated by from style.scss -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Slick styling -->
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/jquery.slick/1.6.0/slick.css"/>
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/jquery.slick/1.6.0/slick-theme.css"/>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- metadata -->
    <meta name="og:title" content="abseil / Tip of the Week #99: Nonmember Interface Etiquette"/>
	 <meta name="og:description" content="An open-source collection of core C++ library code"/>
  </head>
  <body class=>

  	<nav id="sticky-nav">
  <div class="nav-container container">
    <div class="row">
      <div class="col-md-11 nofloat center-block">
        <a class="col-xs-2" href="/">
          <img class="nav-logo" src="/img/absl_18px.svg" alt="Abseil">
        </a>

        <div class="col-xs-2 col-xs-offset-8">
          <button type="button" class="hamburger navbar-toggle collapsed" data-target="#navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>

        <ul class="nav col-xs-10">
          
          <li><a href="/about" >About</a></li>
          <li><a href="/docs/" >Docs</a></li>
		  <li><a href="/tips/" class='current'>Tips</a></li>
          <li><a href="/blog/" >Blog</a></li>
          <li><a href="/community/" >Community</a></li>
        </ul>

      </div>
    </div>
  </div>

  <div class="top-nav right">
    
    <li class="nav-item"><a href="/"><p>Home</p></a><div class="nav-toggle icon-close"></div></li>
    <hr>
    <li class="nav-item"><a href="/about" ><p>About</p></a></li>
    <hr>
    <li class="nav-item"><a href="/docs/" ><p>Docs</p></a>
      <div class="nav-doc-toggle icon-caret"></div>
      <ul class="doc-list">
        <a href="/docs/cpp" ><li class="nav-doc-tab">C++ Devguide</li></a>
        <a href="/docs/cpp/quickstart" ><li class="nav-doc-tab">C++ Quick Start</li></a>
      </ul>
    </li>
    <hr>
    <li class="nav-item"><a href="/tips/" class='current'><p>Tips</p></a></li>
    <hr>
    <li class="nav-item"><a href="/blog/" ><p>Blog</p></a></li>
    <hr>
    <li class="nav-item"><a href="/community/" ><p>Community</p></a></li>
  </div>
</nav>


<div class="nav-hero-container">
	<nav id="common-nav">
  <div class="nav-container container">
    <div class="row">
      <div class="col-md-11 nofloat center-block">
        <a class="col-xs-2" href="/">
          <img class="nav-logo" src="/img/absl_80px.png" alt="Abseil">
        </a>

        <div class="col-xs-2 col-xs-offset-8">
          <button type="button" class="hamburger navbar-toggle collapsed" data-target="#navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>

        <ul class="nav col-xs-10">
          
          <li><a href="/about" >About</a></li>
          <li><a href="/docs/" >Docs</a></li>
          <li><a href="/tips/" class='current'>C++ Tips</a></li>
		  <li><a href="/blog/" >Blog</a></li>
          <li><a href="/community" >Community</a></li>
        </ul>

      </div>
    </div>
  </div>

  <div class="top-nav right">
    
    <li class="nav-item"><a href="/"><p>Home</p></a><div class="nav-toggle icon-close"></div></li>
    <hr>
    <li class="nav-item"><a href="/about/" ><p>About</p></a></li>
    <hr>
    <li class="nav-item"><a href="/docs/" ><p>Docs</p></a>
      <div class="nav-doc-toggle icon-caret"></div>
      <ul class="doc-list">
        <a href="/docs/cpp/quickstart" ><li class="nav-doc-tab">Quickstart</li></a>
      </ul>
    </li>
    <hr>
    <li class="nav-item"><a href="/blog/" ><p>Blog</p></a></li>
    <hr>
    <li class="nav-item"><a href="/tips/" class='current'><p>Tips</p></a></li>
    <hr>
    <li class="nav-item"><a href="/community/" ><p>Community</p></a></li>
  </div>
  <div class="container">
    <div class="row">
      <div class="col-md-11 nofloat center-block">
        <div class="col-xs-12">
          <h1 class="page-headline"></h1> 
        </div>
      </div>
    </div>
  </div>

</nav>

   <a href="https://github.com/abseil/" class="fork-btn" target="_blank"></a>

</div>



<div class="container">
<div class="row">
<div class="col-md-12 nofloat center-block ">
<div class="col-sm-3">
<ul class="doc-side-nav">
   <li><h5 class="doc-side-nav-title">
    <a href="/tips/">C++ Tips</a></h5>
   </li>
   

   
     
   
     
   
     
   
     
   
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/1">TotW #1: string_view</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/42">TotW #42: Prefer Factory Functions to Initializer Methods</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/49">TotW #49: Argument-Dependent Lookup</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/55">TotW #55: Name Counting and unique_ptr</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/64">TotW #64: Raw String Literals</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/65">TotW #65: Putting Things in their Place</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/74">TotW #74: Delegating and Inheriting Constructors</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/77">TotW #77: Temporaries, Moves, and Copies</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/86">TotW #86: Enumerating with Class</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/94">TotW #94: Callsite Readability and bool Parameters</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/99">TotW #99: Nonmember Interface Etiquette</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/101">TotW #101: Return Values, References, and Lifetimes</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/107">TotW #107: Reference Lifetime Extension</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/109">TotW #109: Meaningful `const` in Function Declarations</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/112">TotW #112: emplace vs. push_back</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/119">TotW #119: Using-declarations and namespace aliases</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/122">TotW #122: Test Fixtures, Clarity, and Dataflow</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/123">TotW #123: <code>absl::optional</code> and <code>std::unique_ptr</code></a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/126">TotW #126: `make_unique` is the new `new`</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/130">TotW #130: Namespace Naming</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/131">TotW #131: Special Member Functions and `= default`</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/135">TotW #135: Test the Contract, not the Implementation</a></h6>
     </li>
     
   
 </ul>

</div>
<div class="col-sm-8 markdown">
<h1>Tip of the Week #99: Nonmember Interface Etiquette</h1>
<p>Originally posted as totw/99 on 2015-06-24</p>

<p>Revised 2017-10-10</p>

<p>The interface of a C++ class is not constrained to its members or to its
definition. When evaluating an API, we must consider definitions beyond the
class body that can be as much a part of its interface as its public members.</p>

<p>These external interface points include template specializations like hashers or
traits, nonmember operator overloads (e.g. logging, relationals), and other
canonical nonmember functions designed for use with argument-dependent lookup
(ADL), most notably <code class="highlighter-rouge">swap()</code>.</p>

<p>A few of these are illustrated below for some sample class <code class="highlighter-rouge">space::Key</code>:</p>

<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="k">namespace</span> <span class="n">space</span> <span class="p">{</span>
<span class="k">class</span> <span class="nc">Key</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>

<span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">Key</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Key</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">);</span>
<span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Key</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Key</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">swap</span><span class="p">(</span><span class="n">Key</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">,</span> <span class="n">Key</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">);</span>

<span class="c1">// standard streaming
</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Key</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">);</span>

<span class="c1">// gTest printing
</span><span class="kt">void</span> <span class="n">PrintTo</span><span class="p">(</span><span class="k">const</span> <span class="n">Key</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span> <span class="n">os</span><span class="p">);</span>

<span class="c1">// new-style flag extension:
</span><span class="kt">bool</span> <span class="n">ParseFlag</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">text</span><span class="p">,</span> <span class="n">Key</span><span class="o">*</span> <span class="n">dst</span><span class="p">,</span> <span class="n">string</span><span class="o">*</span> <span class="n">err</span><span class="p">);</span>
<span class="n">string</span> <span class="n">UnparseFlag</span><span class="p">(</span><span class="k">const</span> <span class="n">Key</span><span class="o">&amp;</span> <span class="n">v</span><span class="p">);</span>

<span class="p">}</span>  <span class="c1">// namespace space
</span>
<span class="n">HASH_NAMESPACE_BEGIN</span>
<span class="k">template</span> <span class="o">&lt;&gt;</span>
<span class="k">struct</span> <span class="n">hash</span><span class="o">&lt;</span><span class="n">space</span><span class="o">::</span><span class="n">Key</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="kt">size_t</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">space</span><span class="o">::</span><span class="n">Key</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">HASH_NAMESPACE_END</span>
</code></pre>
</div>

<p>There are some important risks associated with making such extensions
incorrectly, so this article will try to present some guidance.</p>

<h2 id="the-proper-namespace">The Proper Namespace</h2>

<p>Interface points that are functions are usually designed to be found by
argument-dependent lookup (ADL, see <a href="/tips/49">TotW 49</a>). Operators and some
operator-like functions (notably <code class="highlighter-rouge">swap()</code>) are designed to be found by ADL. This
protocol only works reliably when the function is defined in a namespace
associated with the type being customized. The associated namespaces include
those of its base classes and class template parameters. A common mistake is to
place these functions in the global namespace. To illustrate the problem,
consider the following code in which <code class="highlighter-rouge">good(x)</code> and <code class="highlighter-rouge">bad(x)</code> functions are called
with identical syntax:</p>

<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="k">namespace</span> <span class="n">library</span> <span class="p">{</span>
<span class="k">struct</span> <span class="n">Letter</span> <span class="p">{};</span>

<span class="kt">void</span> <span class="n">good</span><span class="p">(</span><span class="n">Letter</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// namespace library
</span>
<span class="c1">// bad is improperly placed in global namespace
</span><span class="kt">void</span> <span class="n">bad</span><span class="p">(</span><span class="n">library</span><span class="o">::</span><span class="n">Letter</span><span class="p">);</span>

<span class="k">namespace</span> <span class="n">client</span> <span class="p">{</span>
<span class="kt">void</span> <span class="n">good</span><span class="p">();</span>
<span class="kt">void</span> <span class="n">bad</span><span class="p">();</span>

<span class="kt">void</span> <span class="nf">test</span><span class="p">(</span><span class="k">const</span> <span class="n">library</span><span class="o">::</span><span class="n">Letter</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">good</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>  <span class="c1">// ok: 'library::good' is found by ADL.
</span>  <span class="n">bad</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>  <span class="c1">// oops: '::bad' is hidden by 'client::bad'.
</span><span class="p">}</span>

<span class="p">}</span>  <span class="c1">// namespace client
</span></code></pre>
</div>

<p>Note the difference between <code class="highlighter-rouge">library::good()</code> and <code class="highlighter-rouge">::bad()</code>. The <code class="highlighter-rouge">test()</code>
function is relying on the absence of any function called <code class="highlighter-rouge">bad()</code> in namespaces
enclosing the call site. The appearance of <code class="highlighter-rouge">client::bad()</code> hides <code class="highlighter-rouge">::bad()</code> from
the <code class="highlighter-rouge">test</code> caller.  Meanwhile, the <code class="highlighter-rouge">good()</code> function is found regardless of what
else exists in the <code class="highlighter-rouge">test()</code> function’s enclosing scope. The C++ name lookup
sequence will only yield a global if a name search from closer lexical scopes to
the call site fails to find any names.</p>

<p>This is all very subtle, which is the point, really. It’s all much simpler if we
<em>default to defining functions alongside the data on which they operate</em>.</p>

<h2 id="a-quick-note-on-in-class-friend-definitions">A Quick Note on In-Class Friend Definitions</h2>

<p>There’s a way to add non-member functions to a class from within the class
definition. Friend functions can be defined directly inside a class.</p>

<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="k">namespace</span> <span class="n">library</span> <span class="p">{</span>
<span class="k">class</span> <span class="nc">Key</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">explicit</span> <span class="n">Key</span><span class="p">(</span><span class="n">string</span> <span class="n">s</span><span class="p">)</span> <span class="o">:</span> <span class="n">s_</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="p">{}</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Key</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Key</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">s_</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">s_</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">Key</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Key</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">s_</span> <span class="o">==</span> <span class="n">b</span><span class="p">.</span><span class="n">s_</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">friend</span> <span class="kt">void</span> <span class="n">swap</span><span class="p">(</span><span class="n">Key</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">,</span> <span class="n">Key</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">swap</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">s_</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">s_</span><span class="p">);</span>
  <span class="p">}</span>

 <span class="k">private</span><span class="o">:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">s_</span><span class="p">;</span>
<span class="p">};</span>
<span class="p">}</span>  <span class="c1">// namespace library
</span></code></pre>
</div>

<p>These friend functions have a special property of ONLY being visible through
ADL. They’re a little strange in that they are defined in the enclosing
namespace, but don’t appear in name lookup there. These in-class <code class="highlighter-rouge">friend</code>
definitions must have inlined bodies for this stealth property to kick in. See
<a href="http://stackoverflow.com/questions/381164/friend-and-inline-method-whats-the-point">“Friend
Definitions”</a>
for more detail.</p>

<p>Such functions will not hide global functions from fragile call sites in their
namespace or appear in diagnostic messages for unrelated calls to functions of
the same name. They get out of the way, essentially. They’re also very
convenient to define, easy to discover, and they have access to class internals.
Probably the biggest drawback is that they will not be found in cases where the
enclosing class is implicitly convertible from an argument type.</p>

<p>Note that access (i.e. <code class="highlighter-rouge">public</code>, <code class="highlighter-rouge">private</code>, and <code class="highlighter-rouge">protected</code>) has no effect on
friend functions, but it might be polite to place these in the public section
anyway, just so they’ll be more visible during perusal of the public API points.</p>

<h2 id="the-proper-source-location">The Proper Source Location</h2>

<p>To avoid violations of the one-definition rule (ODR), any customizations on a
type’s interface should appear where they can’t accidentally be defined multiple
times. This usually means they should be packaged with the type in the same
header. It’s not appropriate to add this sort of nonmember customization in a
<code class="highlighter-rouge">*_test.cc</code> file, or in a “utilities” header off to the side where it can be
overlooked. Force the compiler to see the customization and you will be more
likely to catch violations.</p>

<p>A function overload (including operator overloads) intended as a nonmember
extension should be declared in a header that defines one of its arguments.</p>

<p>The same goes for template specializations. Template specializations can be
packaged with the primary template definition, or packaged with the type on
which it’s being specialized. For partial specializations or with multiple
parameters it’s a judgment call. It’s usually pretty clear in practice which
site is better. The important thing is that the specialization should not be
hidden in client code: it should be as visible as the template and the
user-defined types involved.</p>

<h2 id="when-to-customize">When to Customize</h2>

<p>Don’t customize the behavior of a class in a test. This is dangerous and
unfortunately very common. Test source files are not immune to these dangers and
should follow the same rules as production code. We find a lot of inappropriate
operators in <code class="highlighter-rouge">*_test.cc</code> files that are written with the intent to “get
<code class="highlighter-rouge">EXPECT_EQ</code> to compile” or some other pragmatic concern. Unfortunately they are
still ODR risks (if not violations) and can make library maintenance
difficult. These rogue definitions might even stand in the way of library
maintenance as adding these operators upstream would break the very tests that
needed them and defined their own. For testing there are alternatives available
with a little more effort.</p>

<p>Note that ADL works from the original declaration point for a type. Typedefs,
type aliases, alias templates, and using declarations do not create types and
have no impact on ADL. This can make it a little tricky to locate the proper
placement for customizations, but this cannot be helped, so just do it.</p>

<p>Don’t augment the interface to types generated by protobufs. This is another
common pitfall. You may own the <code class="highlighter-rouge">.proto</code> file, but that doesn’t mean you own the
C++ API it generates, and your augmentations could block improvements to the
generated C++ API. This is an ODR risk because you can’t ensure that your
augmentations are seen whenever the generated header is included.</p>

<p>When defining <code class="highlighter-rouge">T</code>, it may be tempting to define behavior for templates like
<code class="highlighter-rouge">std::vector&lt;T&gt;</code> or <code class="highlighter-rouge">std::pair&lt;T,T&gt;</code>. Though your customizations may take
precedence and may do what you expect, you may be conflicting with other
expected customizations defined on the broader class template.</p>

<p>It’s possible to define some customizations for raw pointers. It may be tempting
in some cases to supply these customizations for <code class="highlighter-rouge">T*</code> along with <code class="highlighter-rouge">T</code>. This is
not advised. It’s dangerous because the customization may conflict with the
expected ordinary behavior of pointers (e.g. the way they’re logged, swapped, or
compared). It’s best to leave pointers alone.</p>

<h2 id="what-to-do-when-youre-stuck">What to Do When You’re Stuck</h2>

<p>Following these guidelines can be challenging. Much of the inappropriate
overloading and specialization seen in C++ code is motivated by a small set of
root causes. Below is a partial listing with successful workarounds. If you
run into a library API that can’t be worked with, please send a note to the
owners to see about adding the appropriate customization hooks. Common APIs should
be usable without breaking these interface packaging guidelines.</p>

<h3 id="testing-a-type-with-expect_eq-etc">Testing a Type with <code class="highlighter-rouge">EXPECT_EQ</code>, etc.</h3>

<p><em>temptation:</em> <code class="highlighter-rouge">EXPECT_EQ</code> requires <code class="highlighter-rouge">operator==</code>, and <code class="highlighter-rouge">operator&lt;&lt;</code> or
GoogleTest’s <code class="highlighter-rouge">PrintTo</code>.</p>

<p><em>workaround:</em> Write lightweight gmock matchers with
<a href="https://github.com/google/googletest/blob/master/googlemock/docs/CookBook.md#writing-new-parameterized-matchers-quickly">MATCHER_P</a>
instead of relying exclusively on <code class="highlighter-rouge">EXPECT_EQ</code> etc.</p>

<p><em>workaround:</em> Create <em>local</em> (this is essential) wrapper types you DO truly own
and provide customizations on those, possibly using trivial inheritance as a
shortcut.</p>

<h3 id="using-t-as-a-container-key">Using <code class="highlighter-rouge">T</code> as a Container Key</h3>

<p><em>temptation:</em> Container default functor types may rely on <code class="highlighter-rouge">operator&lt;</code>,
<code class="highlighter-rouge">operator==</code>, and <code class="highlighter-rouge">hash&lt;T&gt;</code>.</p>

<p><em>workaround:</em> Use more custom comparators or custom hashers. Use more typedefs
for your associative container types to hide these details from client code.</p>

<h3 id="logging-containers-of-t">Logging Containers of <code class="highlighter-rouge">T</code></h3>

<p><em>temptation:</em> Defining <code class="highlighter-rouge">operator&lt;&lt;</code> overloads for standard containers.</p>

<p><em>workaround:</em> Don’t try to log the container directly.</p>

<h2 id="take-aways">Take-Aways</h2>

<p>A type’s behavior is not completely defined by its class definition. Non-member
definitions and specializations also contribute. You may need to keep reading
past that closing brace to really understand how a class works.</p>

<p>Be aware of when and where it’s safe to add these customizations. Adding
inappropriate definitions may get your code to work for now, but you could be
adding fragility and maintenance blockers for other engineers down the line to
deal with.</p>


</div>

<div id="toc" class="col-sm-1"></div>
<br />
<a href="http://feeds.feedburner.com/abseilio"
    title="Subscribe to Abseil Blog &amp; Tips"
    rel="alternate"
    type="application/rss+xml">
    <img src="//feedburner.google.com/fb/images/pub/feed-icon32x32.png"
         alt="Subscribe to the Abseil Blog" style="border:0;">
    </img>
</a>
</div>
</div>
</div>




<footer>
    <div class="container">
        <div class="left-links">
            <img src="/img/typography_white.png" style="height:24px;"/>
            <p class="description">&copy;2017 Abseil | Live at Head</p>
        </div>
        <div class="right-links">
            <div class="col-md-4 col-sm-4 col-xs-12 footer-documentation">
                <ul class="toggle">
                    <a href="/about/"><p class="right-link-headers">About Abseil</p></a>
                    <li><a href="/about/intro"><p>Introduction</p></a></li>
                    <li><a href="/about/philosophy"><p>Philosophy</p></a></li>
                    <li><a href="/about/compatibility"><p>Compatibility</p></a></li>
                    <li><a href="/about/design/"><p>Design Notes</p><a></li>
                 </ul>
            </div>
            <hr class="footer-sections" />
            <div class="col-md-3 col-sm-3 col-xs-12 footer-resources">
                <ul class="toggle">
                    <a href="/docs/"><p class="right-link-headers">Dev Guides</p></a>
                    <li><a href="/docs/cpp.html"><p>C++</p></a></li>
                    <li><a href="/blog/"><p>Abseil Blog</p></a></li>
                </ul>
                </ul>
            </div>
            <hr class="footer-sections" />
            <div class="col-md-5 col-sm-5 col-xs-12 footer-community">
                <ul class="toggle">
                    <a href="/community/"><p class="right-link-headers">Community</p></a>
                    <li><a href="https://github.com/abseil/" target="_blank"><p class="github community-links">GitHub</p></a></li>
                    <li><a href="https://twitter.com/abseilio" target="_blank"><p class="twitter community-links">Twitter</p></a></li>
                    <li><a href="http://stackoverflow.com/tags/abseil/" target="_blank"><p class="stack-overflow community-links">Stack Overflow</p></a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>


    <script src="/libs/bootstrap/js/bootstrap.min.js"></script>
    <!-- Include SlickJS for carousel -->
    <script src="/js/slick.min.js"></script>
    <script src="/js/jquery.visible.min.js"></script>
    <!-- Include the common site javascript -->
    <script src="/js/common.js" type="text/javascript" charset="utf-8"></script>
    <!-- GA -->
    <script src="/js/waves.js"></script>
    <script src="/js/buttons.js"></script>
    
    

    
	
	<!-- Global Site Tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-106933809-1"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments)};
	  gtag('js', new Date());

	  gtag('config', 'UA-106933809-1');
	</script>

  </body>
</html>

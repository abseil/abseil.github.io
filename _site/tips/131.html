<!DOCTYPE html>
<html lang="en" itemscope itemtype="https://schema.org/WebPage">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="title" content="Abseil open-source foundational code">
    <meta name="description" content="Battle-tested, Mom-approved">
    <title>abseil / Tip of the Week #131: Special Member Functions and `= default`</title>

    <!-- Fontawesome Icons -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    
    <!-- Favicons -->
    <link rel="shortcut icon" type="image/x-icon" href="/favicons/favicon.ico" />
    
    <!-- Bootstrap -->
    <link href="/libs/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Site style using SASS, generated by from style.scss -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Slick styling -->
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/jquery.slick/1.6.0/slick.css"/>
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/jquery.slick/1.6.0/slick-theme.css"/>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- metadata -->
    <meta name="og:title" content="abseil / Tip of the Week #131: Special Member Functions and `= default`"/>
	 <meta name="og:description" content="An open-source collection of core C++ library code"/>
  </head>
  <body class=>

  	<nav id="sticky-nav">
  <div class="nav-container container">
    <div class="row">
      <div class="col-md-11 nofloat center-block">
        <a class="col-xs-2" href="/">
          <img class="nav-logo" src="/img/absl_18px.svg" alt="Abseil">
        </a>

        <div class="col-xs-2 col-xs-offset-8">
          <button type="button" class="hamburger navbar-toggle collapsed" data-target="#navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>

        <ul class="nav col-xs-10">
          
          <li><a href="/about" >About</a></li>
          <li><a href="/docs/" >Docs</a></li>
		  <li><a href="/tips/" class='current'>Tips</a></li>
          <li><a href="/blog/" >Blog</a></li>
          <li><a href="/community/" >Community</a></li>
        </ul>

      </div>
    </div>
  </div>

  <div class="top-nav right">
    
    <li class="nav-item"><a href="/"><p>Home</p></a><div class="nav-toggle icon-close"></div></li>
    <hr>
    <li class="nav-item"><a href="/about" ><p>About</p></a></li>
    <hr>
    <li class="nav-item"><a href="/docs/" ><p>Docs</p></a>
      <div class="nav-doc-toggle icon-caret"></div>
      <ul class="doc-list">
        <a href="/docs/cpp" ><li class="nav-doc-tab">C++ Devguide</li></a>
        <a href="/docs/cpp/quickstart" ><li class="nav-doc-tab">C++ Quick Start</li></a>
      </ul>
    </li>
    <hr>
    <li class="nav-item"><a href="/tips/" class='current'><p>Tips</p></a></li>
    <hr>
    <li class="nav-item"><a href="/blog/" ><p>Blog</p></a></li>
    <hr>
    <li class="nav-item"><a href="/community/" ><p>Community</p></a></li>
  </div>
</nav>


<div class="nav-hero-container">
	<nav id="common-nav">
  <div class="nav-container container">
    <div class="row">
      <div class="col-md-11 nofloat center-block">
        <a class="col-xs-2" href="/">
          <img class="nav-logo" src="/img/absl_80px.png" alt="Abseil">
        </a>

        <div class="col-xs-2 col-xs-offset-8">
          <button type="button" class="hamburger navbar-toggle collapsed" data-target="#navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>

        <ul class="nav col-xs-10">
          
          <li><a href="/about" >About</a></li>
          <li><a href="/docs/" >Docs</a></li>
          <li><a href="/tips/" class='current'>C++ Tips</a></li>
		  <li><a href="/blog/" >Blog</a></li>
          <li><a href="/community" >Community</a></li>
        </ul>

      </div>
    </div>
  </div>

  <div class="top-nav right">
    
    <li class="nav-item"><a href="/"><p>Home</p></a><div class="nav-toggle icon-close"></div></li>
    <hr>
    <li class="nav-item"><a href="/about/" ><p>About</p></a></li>
    <hr>
    <li class="nav-item"><a href="/docs/" ><p>Docs</p></a>
      <div class="nav-doc-toggle icon-caret"></div>
      <ul class="doc-list">
        <a href="/docs/cpp/quickstart" ><li class="nav-doc-tab">Quickstart</li></a>
      </ul>
    </li>
    <hr>
    <li class="nav-item"><a href="/blog/" ><p>Blog</p></a></li>
    <hr>
    <li class="nav-item"><a href="/tips/" class='current'><p>Tips</p></a></li>
    <hr>
    <li class="nav-item"><a href="/community/" ><p>Community</p></a></li>
  </div>
  <div class="container">
    <div class="row">
      <div class="col-md-11 nofloat center-block">
        <div class="col-xs-12">
          <h1 class="page-headline"></h1> 
        </div>
      </div>
    </div>
  </div>

</nav>

   <a href="https://github.com/abseil/" class="fork-btn" target="_blank"></a>

</div>



<div class="container">
<div class="row">
<div class="col-md-12 nofloat center-block ">
<div class="col-sm-3">
<ul class="doc-side-nav">
   <li><h5 class="doc-side-nav-title">
    <a href="/tips/">C++ Tips</a></h5>
   </li>
   

   
     
   
     
   
     
   
     
   
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/1">TotW #1: string_view</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/3">TotW #3: String Concatenation and operator+ vs. StrCat()</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/10">TotW #10: Splitting Strings, not Hairs</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/36">TotW #36: New Join API</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/42">TotW #42: Prefer Factory Functions to Initializer Methods</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/49">TotW #49: Argument-Dependent Lookup</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/55">TotW #55: Name Counting and unique_ptr</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/59">TotW #59: Joining Tuples</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/64">TotW #64: Raw String Literals</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/65">TotW #65: Putting Things in their Place</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/74">TotW #74: Delegating and Inheriting Constructors</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/77">TotW #77: Temporaries, Moves, and Copies</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/86">TotW #86: Enumerating with Class</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/88">TotW #88: Initialization: =, (), and {}</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/94">TotW #94: Callsite Readability and bool Parameters</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/99">TotW #99: Nonmember Interface Etiquette</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/101">TotW #101: Return Values, References, and Lifetimes</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/107">TotW #107: Reference Lifetime Extension</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/109">TotW #109: Meaningful `const` in Function Declarations</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/112">TotW #112: emplace vs. push_back</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/119">TotW #119: Using-declarations and namespace aliases</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/122">TotW #122: Test Fixtures, Clarity, and Dataflow</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/123">TotW #123: <code>absl::optional</code> and <code>std::unique_ptr</code></a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/126">TotW #126: `make_unique` is the new `new`</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/130">TotW #130: Namespace Naming</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/131">TotW #131: Special Member Functions and `= default`</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/135">TotW #135: Test the Contract, not the Implementation</a></h6>
     </li>
     
   
     
     <li><h6 class="doc-side-nav-list-item">
         <a href="/tips/142">TotW #142: Multi-parameter Constructors and `explicit`</a></h6>
     </li>
     
   
 </ul>

</div>
<div class="col-sm-8 markdown">
<h1>Tip of the Week #131: Special Member Functions and `= default`</h1>
<p>Originally posted as totw/131 on 2017-03-24</p>

<p>By James Dennett <a href="mailto:jdennett@google.com">(jdennett@google.com)</a></p>

<p>Since the beginning of time, C++ has supported compiler-declared versions of
some so-called <em>special member functions</em>: the default constructor, destructor,
copy constructor and copy assignment operators. C++11 added move construction
and move assignment to the list, and added syntax (<code class="highlighter-rouge">=default</code> and <code class="highlighter-rouge">=delete</code>) to
give control over when those defaults are declared and defined.</p>

<h2 id="what-does-default-do-and-why-would-we-use-it">What Does <code class="highlighter-rouge">=default</code> Do, and Why Would We Use It?</h2>

<p>Writing <code class="highlighter-rouge">=default</code> is our way to tell the compiler “do what you would normally
have done for this special member function”. Why might we want to do this
rather than writing an implementation by hand or leaving the compiler to
declare one for us?</p>

<ul>
  <li>We can change the access level (e.g., make a constructor <code class="highlighter-rouge">protected</code> instead
of <code class="highlighter-rouge">public</code>), make a destructor virtual, or reinstate a function that would
be suppressed (e.g., a default constructor for a class that has other
user-declared constructors) and still get the compiler to generate the
function for us.</li>
  <li>Compiler-defined copy and move operations don’t need maintenance every time
members are added or removed, if copying/moving the members is sufficient.</li>
  <li>Compiler-provided special member functions can be <em>trivial</em> (when all of the
operations they invoke are themselves trivial), which can make them faster
and safer.</li>
  <li>Types with defaulted constructors can be <em>aggregates</em>, and hence support
<em>aggregate initialization</em>, whereas those with user-provided constructors
cannot.</li>
  <li>Explicitly declaring a defaulted member gives us a place to document the
semantics of the resulting function.</li>
  <li>In a class template, <code class="highlighter-rouge">=default</code> is a simple way to declare an operation
conditionally, based on whether some underlying type provides it.</li>
</ul>

<p>When we use <code class="highlighter-rouge">=default</code> on the initial declaration of a special member function,
the compiler will check whether it can synthesize an inline definition for that
function. If it can, it does. If it can’t, the function is actually declared as
<em>deleted</em>, just as if we’d written <code class="highlighter-rouge">=delete</code>. That’s just what we’d need for
transparently wrapping a class (say, if we’re defining a class template), but it
can be surprising to readers.</p>

<p>If a function’s initial declaration uses <code class="highlighter-rouge">=default</code>, or if the compiler declares
a special member function that is not user-declared, an appropriate <code class="highlighter-rouge">noexcept</code>
specification is deduced, potentially allowing faster code.</p>

<h2 id="how-does-it-work">How Does It Work?</h2>

<p>Before C++11, if we needed a default constructor and already had other
constructors, we’d have written one as:</p>

<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">A</span><span class="p">()</span> <span class="p">{}</span>  <span class="c1">// User-provided, non-trivial constructor makes A a non-aggregate.
</span><span class="p">};</span>
</code></pre>
</div>

<p>From C++11 onwards we have more options.</p>

<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">C</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">C</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>  <span class="c1">// misleading: C has a deleted default constructor
</span> <span class="nl">private:</span>
  <span class="k">const</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>  <span class="c1">// const =&gt; must always be initialized.
</span><span class="p">};</span>

<span class="k">class</span> <span class="nc">D</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">D</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>  <span class="c1">// unsurprising, but not explicit: D has a default constructor
</span> <span class="nl">private:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">;</span>  <span class="c1">// std::unique_ptr has a default constructor
</span><span class="p">};</span>
</code></pre>
</div>

<p>Clearly we shouldn’t write code like <code class="highlighter-rouge">class C</code>: in a non-template, use
<code class="highlighter-rouge">=default</code> only if you intend the class to support the operation (and then test
that it does).  <em><code class="highlighter-rouge">clang-tidy</code></em> includes a check for this.</p>

<p>When <code class="highlighter-rouge">=default</code> is used <em>after</em> the first declaration of a special member
function (i.e., outside of the class), it has a simpler meaning: it tells the
compiler to define the function, and to give an error if it is unable to do so.
When <code class="highlighter-rouge">=default</code> is used outside of the class, the defaulted function will not be
trivial: triviality is determined by the first declaration (so that all clients
agree on whether the operation is trivial or not).</p>

<p>If you don’t need your class to be an aggregate and you don’t need the
constructor to be trivial then defaulting the constructor outside of the class
definition, like examples <code class="highlighter-rouge">E</code> and <code class="highlighter-rouge">F</code> below, is often a good choice.  Its meaning
is clear to readers, and is checked by the compiler.  For the special case of
defaulting a <em>default</em> constructor or a destructor we could write <code class="highlighter-rouge"><span class="p">{}</span></code> instead
of <code class="highlighter-rouge">=default</code>, but for other defaulted operations the compiler-generated
implementation is less simple, and for consistency it’s good to write <code class="highlighter-rouge">=default</code>
in all applicable cases.</p>

<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">E</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">E</span><span class="p">();</span>  <span class="c1">// promises to have a default constructor, but...
</span> <span class="nl">private:</span>
  <span class="k">const</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>  <span class="c1">// const =&gt; must always be initialized.
</span><span class="p">};</span>
<span class="kr">inline</span> <span class="n">E</span><span class="o">::</span><span class="n">E</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>  <span class="c1">// compilation error here: would not initialize `i`
</span>
<span class="k">class</span> <span class="nc">F</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">F</span><span class="p">();</span>  <span class="c1">// promises to have a default constructor
</span> <span class="nl">private:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">;</span>  <span class="c1">// std::unique_ptr has a default constructor
</span><span class="p">};</span>
<span class="kr">inline</span> <span class="n">F</span><span class="o">::</span><span class="n">F</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>  <span class="c1">// works as expected
</span></code></pre>
</div>

<h2 id="recommendations">Recommendations</h2>

<p>Prefer <code class="highlighter-rouge">=default</code> over writing an equivalent implementation by hand, even
if that implementation is just <code class="highlighter-rouge"><span class="p">{}</span></code>. Optionally, omit <code class="highlighter-rouge">=default</code> from the
initial declaration and provide a separate defaulted implementation.</p>

<p>Be cautious about defaulting move operations. Moved-from objects must still
satisfy the invariants of their type, and the default implementations will
usually not preserve relationships between fields.</p>

<p>Outside of templates, write <code class="highlighter-rouge">=delete</code> instead if <code class="highlighter-rouge">=default</code> wouldn’t provide an
implementation.</p>

</div>

<div id="toc" class="col-sm-1"></div>
<br />
<a href="http://feeds.feedburner.com/abseilio"
    title="Subscribe to Abseil Blog &amp; Tips"
    rel="alternate"
    type="application/rss+xml">
    <img src="//feedburner.google.com/fb/images/pub/feed-icon32x32.png"
         alt="Subscribe to the Abseil Blog" style="border:0;">
    </img>
</a>
</div>
</div>
</div>




<footer>
    <div class="container">
        <div class="left-links">
            <img src="/img/typography_white.png" style="height:24px;"/>
            <p class="description">&copy;2017 Abseil | Live at Head</p>
        </div>
        <div class="right-links">
            <div class="col-md-4 col-sm-4 col-xs-12 footer-documentation">
                <ul class="toggle">
                    <a href="/about/"><p class="right-link-headers">About Abseil</p></a>
                    <li><a href="/about/intro"><p>Introduction</p></a></li>
                    <li><a href="/about/philosophy"><p>Philosophy</p></a></li>
                    <li><a href="/about/compatibility"><p>Compatibility</p></a></li>
                    <li><a href="/about/design/"><p>Design Notes</p><a></li>
                 </ul>
            </div>
            <hr class="footer-sections" />
            <div class="col-md-3 col-sm-3 col-xs-12 footer-resources">
                <ul class="toggle">
                    <a href="/docs/"><p class="right-link-headers">Dev Guides</p></a>
                    <li><a href="/docs/cpp.html"><p>C++</p></a></li>
                    <li><a href="/blog/"><p>Abseil Blog</p></a></li>
                </ul>
                </ul>
            </div>
            <hr class="footer-sections" />
            <div class="col-md-5 col-sm-5 col-xs-12 footer-community">
                <ul class="toggle">
                    <a href="/community/"><p class="right-link-headers">Community</p></a>
                    <li><a href="https://github.com/abseil/" target="_blank"><p class="github community-links">GitHub</p></a></li>
                    <li><a href="https://twitter.com/abseilio" target="_blank"><p class="twitter community-links">Twitter</p></a></li>
                    <li><a href="http://stackoverflow.com/tags/abseil/" target="_blank"><p class="stack-overflow community-links">Stack Overflow</p></a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>


    <script src="/libs/bootstrap/js/bootstrap.min.js"></script>
    <!-- Include SlickJS for carousel -->
    <script src="/js/slick.min.js"></script>
    <script src="/js/jquery.visible.min.js"></script>
    <!-- Include the common site javascript -->
    <script src="/js/common.js" type="text/javascript" charset="utf-8"></script>
    <!-- GA -->
    <script src="/js/waves.js"></script>
    <script src="/js/buttons.js"></script>
    
    

    
	
	<!-- Global Site Tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-106933809-1"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments)};
	  gtag('js', new Date());

	  gtag('config', 'UA-106933809-1');
	</script>

  </body>
</html>
